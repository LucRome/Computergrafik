# Generating Camera Rays
- means generation of primary rays
- [scratchapixel.com](https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-generating-camera-rays)
- ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/campixel.gif?)
- Start from the camera (often [0,0,0])
- Film of the Camera is between the camera and the objects
    - By convention often placed exactly 1 unit away from the camera
- Camera is oriented along the negative z-axis (like in OpenGL, Maya, ...)

## Square Image
- assumption: rendered image is a square (simplification)
    - ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/cambasic.png?)
- Rays are generated by drawing a straight from the camera to the center of each pixel
    - therefore Pixel coordinates which is originally expressed as a **raster space** need to be transformed to world space
    - ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/cambasic1A.png?)
    - First the Pixel Position is normalized with the frame dimensions -> defined in **NDC space** (Normalised Device coordinates, maps to [0, 1] not like in the rasterization World where it maps to [-1, 1])
    $$
    \begin{array}{ll}
    Pixel_{NDC,x} = \frac{Pixel_x + 0.5}{ImageWidth} \\
    \\
    Pixel_{NDC,y} = \frac{Pixel_y + 0.5}{ImageHeight} \\
    \end{array}
    $$  
    - shift because camera ray should pass through center of the pixel
        - (only here 0.5) normally: $\frac{PixelWidth}{2}$ and ${\frac{PixelHeight}{2}}$
    - then: (to get screen space coordinates)
    $$
    \begin{array}{ll}
    PixelScreen_x = 2 * Pixel_{NDC,x} - 1 \\
    \\
    PixelScreen_y = 1 - 2 * Pixel_{NDC,y} - 1 \\
    \end{array}
    $$

## Image with other aspect ratio
- ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/camratio.png?)
- with different amounts of pixels on the axis the pixels no longer are squares (need to be made squares again)
$$
\begin{array}{ll}
ImageAspectRatio = \frac{ImageWidth}{ImageHeight} \\
PixelCamera_x = (2 * PixelScreen_x - 1) * ImageAspectRatio \\
PixelCamera_y = (1-2*PixelScreen_y) \\
\end{array}
$$
- x coordinates now range to [-1.4, 1.4]

## Field of View
- previously y Coordinates ranged [-1, 1]
- image plane is 1 unit away from camera origin
- ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/camprofile.png?)
- $\alpha$ can be computed
    $$ 
    \boxed{ \begin{array}{ll}
        \frac{\alpha}{2} = \arctan{(\frac{OppositeSide}{AdjacentSide})} = \arctan{(\frac{1}{1})} = \frac{\pi}{4} \\
        \\
        ||BC|| = \tan(\frac{\alpha}{2})
    \end{array}}
    $$
- this means pixels can be scaled using $\alpha$ to account for the FOV
    - zooming in: smaller FOV, zooming out: bigger FOV
    $$
    \boxed{ \begin{array}{ll}
        PixelCamera_x = (2 * PixelScreen_x - 1) * ImageAspectRatio * \tan{\frac{\alpha}{2}} \\
        \\
        PixelCamera_y = (1 - 2 * PixelScreen_y) * \tan{\frac{\alpha}{2}}
    \end{array}}
    $$
- Pixels are now in **Camera Space** (same as **World Space** when Camera is at (0,0))
    - Camera is aligned with negative z-Axis, Plane is 1 unit away from camera point
    - Final Point can be expressed as $\boxed{P_{cameraSpace} = (PixelCamera_x, PixelCamera_y, -1)}$
- this gives us a point in the image plane of the camera

## Moving Camera around
- ![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/camtransform.png?)
- Translation and Rotation of the Camera can be expressed using a 4x4 Matrix
    - normally called **camera-to-world matrix** (and inverse is called **world-to-camera matrix**)
    - when camera is applied to to the points O and P we get the Points O' and P'
    - the vector $\vec{O'P'}$ represents the normalized direction of the ray in world space
    - another option would be to first compute $\vec{OP}$ and then apply the camera-to-world matrix to it

## Neccessary Equations
![](https://www.scratchapixel.com/images/upload/ray-tracing-camera/trigosetup.png?)
- u,v,w are the 1st, 2nd and 3rd Vector of the camera-to-world matrix (when using column major)
- d -> direction of the ray (needs to be normalized in the end)
$$
\boxed{\begin{array}{ll}
d = xu + y \cdot (-v) + w\prime \\
with: \\
w\prime = \frac{-width}{2} * u + \frac{height}{2} * v - \frac{height / 2}{\tan{(fov * 0.5)}} * w
\end{array}} \\
$$
- $w\prime$ can be precomputed

## Summary
- We are now able to compute the primary rays
- **Column Major Matrices are used**



# Creating a simple Ray Tracer
- [scratchapixel.com](https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes)

# Common Coordinate Systems
- [scratchapixel.com](https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-generating-camera-rays/standard-coordinate-systems)